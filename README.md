# r072s-video

Код реализует простую систему видеотрансляции с удалённой камеры в браузере и серверной трансляцией полученного видеопотока в формате MJPEG.

Вот как это работает по шагам:

Получение видео с камеры (index.html):

В браузере запускается скрипт, который получает доступ к камере пользователя через navigator.mediaDevices.getUserMedia({video: true}).

Полученное видео выводится на <video> элемент с id "video".

Создаётся невидимый <canvas>, куда каждые 100 мс (то есть 10 кадров в секунду) копируется текущий кадр с видео.

Этот кадр конвертируется методом canvas.toBlob() в JPEG изображение (сжатие 80%).

Полученный JPEG-контент отправляется POST-запросом (fetch) на сервер по адресу https://truruki.ru/upload с заголовком Content-Type: image/jpeg.

Получение и трансляция кадров на сервере (index.js):

Сервер на Node.js с использованием Express слушает порт 30333.

Он принимает POST-запросы на /upload, где получает в тело запроса JPEG-кадр, сохраняет его в переменную latestFrame и отсылает его всем подключённым клиентам (держит их в списке clients).

Сервер поддерживает GET-запрос /stream, на котором создаёт HTTP ответ с заголовком Content-Type: multipart/x-mixed-replace; boundary=frame — это типичный заголовок для MJPEG-потока.

Каждому подключённому клиенту через res.write() отправляются отдельные JPEG-кадры, формирующие непрерывный видеопоток.

Просмотр видеотрансляции:

При переходе на корневой URL сервера / клиент получает простую HTML-страницу с тегом <img src="/stream">, который отображает поток MJPEG с сервера. Таким образом, на этой странице смотрящий видит видео с камеры.

Особенности CORS:

Сервер настроен на разрешение кросс-доменных запросов (CORS) с указанных доменов (truruki.ru и вариаций), чтобы браузер не блокировал отправку кадров с страницы камеры.

Итог:

Браузер пользователя захватывает камеру, кадры периодически отправляются на сервер.

Сервер принимает JPEG-кадры, хранит последний, и трансляцией через MJPEG поток раздаёт их подключённым клиентам.

Клиенты могут подключиться к серверу и посмотреть видеотрансляцию в реальном времени через HTML-страницу.

Таким образом, реализована система удалённого видеонаблюдения с камерой, отправляющей кадры к серверу, который служит ретранслятором для множества зрителей.

Основные технологии:

В браузере: getUserMedia, <video>, <canvas>, fetch для POST запросов с Blob (JPEG кадр).

На сервере: Express.js, middleware express.raw() для приёма изображений, поддержка CORS, мультиплексирование потоков MJPEG через multipart/x-mixed-replace.

Это классический подход для реализации веб-видео с минимальными сторонними зависимостями